#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <pthread.h>
#include <semaphore.h>
sem_t semaphor;
void *before(void *args){
   // sleep(2);
    unsigned long i = 0;
    printf("\nAvant: debut\n");
    for(i=0;i<100000000;i++);
    printf("\nAvant : Fin");
    sem_post(&semaphor);
    return NULL;
}

void *after(void *args){
    sem_wait(&semaphor);
    unsigned long i = 0;
    printf("\nAvant: debut\n");
    for(i=0;i<1000000000;i++);
    printf("\nAvant : Fin");
    return NULL;
}

int main(){
    pthread_t tid[2];
    int i = 0 , err;
    err = sem_init(&semaphor,0,0);
    if(err != 0)
        perror("erreur de sem_init");
    void*(*f[])(void*) = {before,after};
    while(i <2){
        err = pthread_create(tid + i,NULL,f[i],NULL);
        if(err != 0)
            fprintf(stderr,"Erreur de creation du thread %d\n",i);
        i++;
    }
    for(i = 0;i<2;i++)
        pthread_join(tid[i],NULL);
    err = sem_destroy(&semaphor);
    if(err != 0) perror("Fermeture du semaphore");
    return EXIT_SUCCESS;
}
