#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <fcntl.h>
#include <sys/wait.h>
#include <string.h>
#include <errno.h>
#include <math.h>
#include <ctype.h>
int main()
{ int tube1[2] , tube2[2] ;
    pid_t pidfils ;
     char ch1[8] , ch2[5];
     // creation des tube1
     if(pipe(tube1)!= 0){
         perror("Erreur de pip1 :");
         exit(errno);
    }
    if(pipe(tube2) != 0){
          perror("Erreur de pip2 :");
         exit(errno);
    }
    pidfils = fork();
if(pidfils == -1){
    perror("fok");
    exit(1);
}
else if(pidfils > 0){
    // fermeture dans pere vers fils
    close(tube1[0]);
    //fermeture dans fils vers pere
    close(tube2[1]);
    if(write(tube1[1], "hello" ,5) != 5){
        fprintf(stderr,"erreur d'ecriture dans le pere");
        exit(1);
    }
    // lecture dans pere
    if(read(tube2[0] ,ch1 ,8) != 8){
        fprintf(stderr,"erreur de lecture dans le pere");
        exit(2);
    }
    printf("le pere a lu : %s\n",ch1);
    wait(NULL);
}
else if(pidfils == 0){

    close(tube1[1]);
    close(tube2[0]);
    if(write(tube2[1] , "helloDad",8) != 8){
        fprintf(stderr,"Erreur d'ecriture dans le fils ");
        exit(3);
    }
    if(read(tube1[0] ,ch2 ,5) != 5){
        fprintf(stderr,"erreur de l'ecriture dans le fils");
        exit(4);
    }
    printf("le fils a lu dans le pere: %s\n",ch2);
}
return 0;
}
