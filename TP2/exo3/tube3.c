#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>

int main() {
    int gauche[2], droite[2], result_pipe[2]; // Pipes pour la communication
    pid_t fils_gauche, fils_droite;

    if (pipe(gauche) == -1 || pipe(droite) == -1 || pipe(result_pipe) == -1) {
        perror("Erreur de création de pipe");
        exit(EXIT_FAILURE);
    }

    fils_gauche = fork();
    if (fils_gauche == -1) {
        perror("Erreur de fork pour le fils gauche");
        exit(EXIT_FAILURE);
    }

    if (fils_gauche == 0) {
        // Fils gauche
        close(gauche[1]);
        close(droite[0]);
        close(droite[1]);
        close(result_pipe[0]);

        int num, sum = 0;
        while (read(gauche[0], &num, sizeof(int)) > 0) {
            sum += num; // Somme des nombres négatifs
        }
        close(gauche[0]);

        write(result_pipe[1], &sum, sizeof(int));
        close(result_pipe[1]);
        exit(EXIT_SUCCESS);
    }

    fils_droite = fork();
    if (fils_droite == -1) {
        perror("Erreur de fork pour le fils droit");
        exit(EXIT_FAILURE);
    }

    if (fils_droite == 0) {
        // Fils droit
        close(droite[1]);
        close(gauche[0]);
        close(gauche[1]);
        close(result_pipe[0]);

        int num, sum = 0;
        while (read(droite[0], &num, sizeof(int)) > 0) {
            sum += num; // Somme des nombres positifs
        }
        close(droite[0]);

        write(result_pipe[1], &sum, sizeof(int));
        close(result_pipe[1]);
        exit(EXIT_SUCCESS);
    }

    // Père
    close(gauche[0]);
    close(droite[0]);
    close(result_pipe[1]);

    int num;
    printf("Entrez des entiers (0 pour terminer) :\n");
    while (1) {
        scanf("%d", &num);
        //read(0,&num,sizeof(int));
        if (num == 0) break;
        if (num < 0) {
            write(gauche[1], &num, sizeof(int));
        } else {
            write(droite[1], &num, sizeof(int));
        }
    }

    close(gauche[1]);
    close(droite[1]);

    int left_sum, right_sum;
    read(result_pipe[0], &left_sum, sizeof(int));
    read(result_pipe[0], &right_sum, sizeof(int));
    close(result_pipe[0]);

    // Attendre les processus fils
   wait(NULL);
   wait(NULL);

    printf("Somme des nombres négatifs : %d\n", left_sum);
    printf("Somme des nombres positifs : %d\n", right_sum);

    return 0;
}
