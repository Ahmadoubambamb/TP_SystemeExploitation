#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>
#include <errno.h>
#include <sys/wait.h>
#include <ctype.h>
int main(){
    int tube[2];
    pid_t pidfils;
    char ch1[255] , ch2[255];
    if(pipe(tube) != 0){
        fprintf(stderr,"Erreur de pipe");
        exit(errno);
    }
    pidfils = fork();
    switch(pidfils){
        case -1:
            perror("fork");
            exit(errno);
            break;
        case 0:
            close(tube[1]);
            if(read(tube[0],ch1,255) > 0){
                int i = 0;
                while(ch1[i] !='\0'){
                    ch1[i] = toupper(ch1[i]);
                    i++;
                }
                printf("le fils a lu: %s\n",ch1);
            }
            else{
                fprintf(stderr,"erreur de lecture");
                exit(errno);}
                break;
        default:
            close(tube[0]);
            sprintf(ch2,"message du pere(pid = %d) au fils(pid = %d)\n",getpid(),pidfils);
            if(write(tube[1],ch2,255) <= 0){
                fprintf(stderr,"erreur d'ecriture");
                exit(errno);
            }
            wait(NULL);
            break;
    }
    return 0;
}
