#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/wait.h>

int main() {
    pid_t pid1, pid2, pid3, pid4;

    printf("Début du processus père (PID: %d)\n", getpid());

    // Création du premier fils
    pid1 = fork();
    if (pid1 == 0) { // Code du premier fils
        printf("Premier fils (PID: %d, PPID: %d)\n", getpid(), getppid());

        // Création d'un sous-processus par le premier fils
        pid4 = fork();

        if (pid4 == 0) { // Code du sous-processus du premier fils
            printf("Sous-processus du premier fils (PID: %d, PPID: %d)\n", getpid(), getppid());
            exit(1);
        } else {
            wait(NULL); // Le premier fils attend la fin de son sous-processus
        }
        exit(EXIT_SUCCESS);
    } else {
        // Création du deuxième fils
        pid2 = fork();
        if (pid2 == 0) { // Code du deuxième fils
            printf("Deuxième fils (PID: %d, PPID: %d)\n", getpid(), getppid());
            // on cree encore un sous-fils
            if(fork() == 0)
            {printf("sous-fils du deuxième fils (PID: %d , PPID: %d)\n",getpid(),getppid());
                exit(1);
            }
            else {wait(NULL);
            exit(EXIT_SUCCESS);
            }
        } else {
            // Création du troisième fils
            pid3 = fork();
            }

            if (pid3 == 0) { // Code du troisième fils
                printf("Troisième fils (PID: %d, PPID: %d)\n", getpid(), getppid());
                exit(EXIT_SUCCESS);
            }
        }

    // Le processus père attend la fin de tous ses fils
    while (wait(NULL) >= 0);

    printf("Fin du processus père (PID: %d)\n", getpid());
    return 0;
}
